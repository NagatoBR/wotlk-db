
-- Halls of Reflection update

-- script target
DELETE FROM spell_script_target WHERE entry IN (70246,70021,70224);
INSERT INTO spell_script_target VALUES
(70021,3,6680021,0),
(70246,3,6680021,0),
(70224,1,37014,0);

-- Texts
SET @TGUID := 2000020742;

DELETE FROM dbscript_string WHERE entry IN (@TGUID,@TGUID+1,@TGUID+2,@TGUID+3,@TGUID+4,@TGUID+5);
INSERT INTO dbscript_string (entry, content_default, sound,type,comment) VALUES
(@TGUID,'Death\'s cold embrace awaits.',17221,1,'Halls of Reflection - Lich King - Endless winter'),
(@TGUID+1,'Succumb to the chill of the grave.',17218,1,'Halls of Reflection - Lich King - Wall 2'),
(@TGUID+2,'Another dead end.',17219,1,'Halls of Reflection - Lich King - Wall 3'),
(@TGUID+3,'How long can you fight it?',17220,1,'Halls of Reflection - Lich King - Wall 4');

-- update Sylvanas text
UPDATE dbscript_string SET content_default='There\'s an opening up ahead. GO NOW!', sound='17059' WHERE entry=2000005883;

-- movement scripts
DELETE FROM dbscripts_on_creature_movement WHERE id IN (3695406,3695407,3695416,3695498,3695418,3695417,3695408,3695435,3695437,3695453,3695457,3695467,3695479,3695519,3755419);
INSERT INTO dbscripts_on_creature_movement (id,delay,command,datalong,datalong2,buddy_entry,search_radius,data_flags,dataint,comments) VALUES
-- first wall
(3695406,0,15,69768,0,37014,6680019,0x10,0,'Lich King - Cast Summon Ice Wall - target first ice wall target'),
(3695406,0,0,0,0,0,0,0,2000005867,'Lich King - say gauntlet start'),
(3695406,3000,15,69780,0,0,0,0,0,'Lich King - Cast Remorseless Winter'),
(3695406,3000,0,0,0,0,0,0,@TGUID,'Lich King - say Endless winter'),
-- first summon
(3695407,0,15,74115,0,0,0,0,0,'Lich King - Cast Pain and Suffering'),
(3695407,1000,15,69818,0,0,0,0,0,'Lich King - Cast Summon Raging Ghoul'),
-- Second wall
(3695416,0,15,69768,0,37014,6680018,0x10,0,'Lich King - Cast Summon Ice Wall - target second ice wall target'),
(3695416,0,0,0,0,0,0,0,@TGUID+1,'Lich King - say second wall'),
-- summon ghoul
(3695417,0,15,69818,0,0,0,0,0,'Lich King - Cast Summon Raging Ghoul'),
-- summon abomination
(3695418,0,15,69835,0,0,0,0,0,'Lich King - Cast Summon Lumbering Abomination'),
-- summon witch doctor
(3695408,0,15,69836,0,0,0,0,0,'Lich King - Cast Summon Risen Witch Doctor'),
-- Third Wall
(3695435,0,15,69768,0,37014,6680016,0x10,0,'Lich King - Cast Summon Ice Wall - target third ice wall target'),
(3695435,0,0,0,0,0,0,0,@TGUID+2,'Lich King - say third wall'),
-- Summon after 3rd wall
(3695437,0,15,69835,0,0,0,0,0,'Lich King - Cast Summon Lumbering Abomination'),
(3695437,2000,15,69836,0,0,0,0,0,'Lich King - Cast Summon Risen Witch Doctor'),
(3695437,5000,15,69835,0,0,0,0,0,'Lich King - Cast Summon Lumbering Abomination'),
-- fourth Wall
(3695453,0,15,69768,0,37014,6680017,0x10,0,'Lich King - Cast Summon Ice Wall - target fourth ice wall target'),
(3695453,0,0,0,0,0,0,0,@TGUID+3,'Lich King - say fourth wall'),
-- Summon after 4th wall
(3695457,0,15,69836,0,0,0,0,0,'Lich King - Cast Summon Risen Witch Doctor'),
(3695457,2000,15,69836,0,0,0,0,0,'Lich King - Cast Summon Risen Witch Doctor'),
(3695467,0,15,69818,0,0,0,0,0,'Lich King - Cast Summon Raging Ghoul'),
(3695467,4000,15,69836,0,0,0,0,0,'Lich King - Cast Summon Risen Witch Doctor'),
-- Remove aura
(3695479,0,14,69780,0,0,0,0,0,'Lich King - Remove Aura Remorseless Winter'),
-- Epilogue
(3695498,0,32,1,0,0,0,0,0,'Lich King - pause WP movement'),
(3695498,0,0,0,0,0,0,0,2000005874,'Lich King - epilog 3'),
-- Jaina epilogue
(3695519,0,32,1,0,0,0,0,0,'Jaina - pause WP Movement'),
(3695519,10000,0,0,0,30344,7120023,0x10,2000005875,'Captain - epilog 4'),
(3695519,10000,14,69866,0,0,0,0,0,'Jaina - remove Harvest Soul aura'),
(3695519,10000,15,70017,0,22515,7120020,0x10,0,'Jaina - cast Gunship Cannon Fire on Trigger'),
(3695519,10000,15,70017,0,22515,7120021,0x10,0,'Jaina - cast Gunship Cannon Fire on Trigger'),
(3695519,10000,15,70017,0,22515,7120022,0x10,0,'Jaina - cast Gunship Cannon Fire on Trigger'),
(3695519,14000,13,0,0,201596,50,0x02,0,'Jaina - close Cave In Door'),
(3695519,15000,15,72830,0,36954,100,0x04,0,'Lich King - cast Achievement Check'),
(3695519,15000,25,0,0,0,0,0,0,'Jaina - set run off'),
(3695519,16000,18,0,0,36954,100,0x04,0,'Lich King - despawn'),
(3695519,16000,32,0,0,0,0,0,0,'Jaina - unpause WP Movement'),
(3695519,21000,0,0,0,30344,7120023,0x10,2000005876,'Captain - epilog 5'),
-- Sylvanas epilogue
(3755419,0,32,1,0,0,0,0,0,'Sylvanas - pause WP Movement'),
(3755419,10000,0,0,0,30824,7130051,0x10,2000005885,'Captain - epilog 4'),
(3755419,10000,14,69866,0,0,0,0,0,'Sylvanas - remove Harvest Soul aura'),
(3755419,10000,15,70017,0,37593,7130000,0x10,0,'Sylvanas - cast Gunship Cannon Fire on Horde Gunship Cannon'),
(3755419,10000,15,70017,0,37593,7130001,0x10,0,'Sylvanas - cast Gunship Cannon Fire on Horde Gunship Cannon'),
(3755419,10000,15,70017,0,37593,7130002,0x10,0,'Sylvanas - cast Gunship Cannon Fire on Horde Gunship Cannon'),
(3755419,14000,13,0,0,201596,50,0x02,0,'Sylvanas - close Cave In Door'),
(3755419,15000,15,72830,0,36954,100,0x04,0,'Lich King - cast Achievement Check'),
(3755419,15000,25,0,0,0,0,0,0,'Sylvanas - set run off'),
(3755419,16000,18,0,0,36954,100,0x04,0,'Lich King - despawn'),
(3755419,16000,32,0,0,0,0,0,0,'Sylvanas - unpause WP Movement'),
(3755419,21000,0,0,0,30824,7130051,0x10,2000005886,'Captain - epilog 5');

-- Gossip scripts fix
UPDATE dbscripts_on_gossip SET datalong2=1 WHERE id=1093101 AND datalong=69763;


-- Lich King movement
DELETE FROM creature_movement_template WHERE entry=36954;
INSERT INTO creature_movement_template(entry, pathId, point, position_x, position_y, position_z, orientation, waittime, script_id, comment) VALUES
(36954, 0, 1, 5558.78, 2254.04, 733.01, 100, 0, 0, ''),
(36954, 0, 2, 5570.38, 2241.01, 733.016, 100, 0, 0, ''),
(36954, 0, 3, 5580.03, 2231.68, 733.011, 100, 0, 0, ''),
(36954, 0, 4, 5593.46, 2220.45, 732.38, 100, 0, 0, ''),
(36954, 0, 5, 5603.27, 2203.59, 731.401, 100, 0, 0, ''),
(36954, 0, 6, 5604.76, 2193.4, 731.215, 100, 6000, 3695406, 'Summon first wall'),
(36954, 0, 7, 5604.11, 2192.16, 731.077, 100, 6000, 3695407, 'Summon ghouls and yell'),
(36954, 0, 8, 5602.49, 2189.04, 731.122, 100, 6000, 3695408, 'Summon witch doctor'),
(36954, 0, 9, 5599.71, 2181.69, 731.09, 100, 0, 0, ''),
(36954, 0, 10, 5598.16, 2178.36, 731.05, 100, 0, 0, ''),
(36954, 0, 11, 5596.7, 2173.95, 731.013, 100, 0, 0, ''),
(36954, 0, 12, 5594.77, 2169.11, 730.971, 100, 0, 0, ''),
(36954, 0, 13, 5592.82, 2165.48, 730.972, 100, 0, 0, ''),
(36954, 0, 14, 5590.86, 2162.52, 730.999, 100, 0, 0, ''),
(36954, 0, 15, 5588.77, 2158.96, 731.038, 100, 0, 0, ''),
(36954, 0, 16, 5584.13, 2151.84, 731.249, 100, 6000, 3695416, 'Summon second wall'),
(36954, 0, 17, 5583.64, 2151.45, 731.186, 100, 5000, 3695417, 'Summon ghouls'),
(36954, 0, 18, 5581.59, 2148.57, 731.258, 100, 1000, 3695418, 'Summon abomination'),
(36954, 0, 19, 5579.21, 2143.29, 731.172, 100, 2000, 3695408, 'Summon witch doctor'),
(36954, 0, 20, 5578.64, 2142.02, 731.163, 100, 2000, 3695408, 'Summon witch doctor'),
(36954, 0, 21, 5576.6, 2141.77, 731.245, 100, 0, 0, ''),
(36954, 0, 22, 5573.64, 2137.63, 731.205, 100, 0, 0, ''),
(36954, 0, 23, 5570.71, 2132.64, 731.055, 100, 0, 0, ''),
(36954, 0, 24, 5567.77, 2128.2, 730.904, 100, 0, 0, ''),
(36954, 0, 25, 5565.13, 2123.85, 730.824, 100, 0, 0, ''),
(36954, 0, 26, 5561.95, 2117.89, 730.837, 100, 0, 0, ''),
(36954, 0, 27, 5558.65, 2111.43, 730.984, 100, 0, 0, ''),
(36954, 0, 28, 5555.9, 2106.6, 731.085, 100, 0, 0, ''),
(36954, 0, 29, 5552.94, 2101.48, 731.109, 100, 0, 0, ''),
(36954, 0, 30, 5550.54, 2096.08, 731.103, 100, 0, 0, ''),
(36954, 0, 31, 5547.62, 2090.07, 731.03, 100, 0, 0, ''),
(36954, 0, 32, 5545.37, 2084.54, 731.108, 100, 0, 0, ''),
(36954, 0, 33, 5543.33, 2079.46, 731.068, 100, 0, 0, ''),
(36954, 0, 34, 5541.17, 2074.6, 730.982, 100, 0, 0, ''),
(36954, 0, 35, 5538.82, 2069.27, 730.974, 100, 6000, 3695435, 'Summon third wall'),
(36954, 0, 36, 5536.74, 2063.56, 731.004, 100, 5000, 3695417, 'Summon ghouls'),
(36954, 0, 37, 5533.73, 2056.7, 730.984, 100, 6000, 3695437, 'Summon abomination, witch doctor, abomination'),
(36954, 0, 38, 5531.33, 2050.93, 731.03, 100, 0, 0, ''),
(36954, 0, 39, 5529.2, 2045.53, 731.109, 100, 0, 0, ''),
(36954, 0, 40, 5526.62, 2039.61, 731.271, 100, 0, 0, ''),
(36954, 0, 41, 5524.24, 2033.28, 731.556, 100, 0, 0, ''),
(36954, 0, 42, 5522.16, 2028.69, 731.918, 100, 0, 0, ''),
(36954, 0, 43, 5519.54, 2023.02, 732.393, 100, 2000, 3695408, 'Summon witch doctor'),
(36954, 0, 44, 5516.31, 2016.34, 733.028, 100, 0, 0, ''),
(36954, 0, 45, 5514.31, 2012.02, 733.504, 100, 0, 0, ''),
(36954, 0, 46, 5511.12, 2006.53, 734.107, 100, 0, 0, ''),
(36954, 0, 47, 5508.16, 2001.79, 734.636, 100, 0, 0, ''),
(36954, 0, 48, 5504.59, 1995.93, 735.285, 100, 0, 0, ''),
(36954, 0, 49, 5501.44, 1990.73, 735.805, 100, 0, 0, ''),
(36954, 0, 50, 5498.21, 1985.03, 736.245, 100, 0, 0, ''),
(36954, 0, 51, 5494.86, 1979.71, 736.606, 100, 0, 0, ''),
(36954, 0, 52, 5491.98, 1975.01, 736.947, 100, 0, 0, ''),
(36954, 0, 53, 5489.68, 1971.34, 737.217, 100, 0, 0, ''),
(36954, 0, 54, 5487.46, 1966.84, 737.471, 100, 6000, 3695453, 'Summon fourth wall'),
(36954, 0, 55, 5483.75, 1960.26, 738.159, 100, 4000, 3695417, 'Summon ghouls'),
(36954, 0, 56, 5481.76, 1957.69, 738.608, 100, 2000, 3695418, 'Summon abomination'),
(36954, 0, 57, 5480.16, 1954.20, 739.215, 100, 4000, 3695457, 'Summon witch doctor, witch doctor'),
(36954, 0, 58, 5477.38, 1948.39, 740.236, 100, 0, 0, ''),
(36954, 0, 59, 5473.75, 1941.08, 741.441, 100, 0, 0, ''),
(36954, 0, 60, 5470.43, 1934.64, 742.357, 100, 0, 0, ''),
(36954, 0, 61, 5467.35, 1929.16, 743.091, 100, 0, 0, ''),
(36954, 0, 62, 5464.36, 1924.13, 743.782, 100, 4000, 3695418, 'Summon abomination'),
(36954, 0, 63, 5459.54, 1916.36, 744.682, 100, 1000, 3695418, 'Summon abomination'),
(36954, 0, 64, 5456.08, 1910.21, 745.670, 100, 0, 0, ''),
(36954, 0, 65, 5452.89, 1904.83, 746.715, 100, 0, 0, ''),
(36954, 0, 66, 5449.00, 1899.35, 747.896, 100, 0, 0, ''),
(36954, 0, 67, 5446.01, 1895.57, 748.649, 100, 9000, 3695467, 'Summon ghouls, witch doctor'),
(36954, 0, 68, 5442.19, 1890.10, 749.753, 100, 2000, 3695408, 'Summon witch doctor'),
(36954, 0, 69, 5439.06, 1885.97, 750.583, 100, 0, 0, ''),
(36954, 0, 70, 5436.14, 1881.25, 751.451, 100, 0, 0, ''),
(36954, 0, 71, 5432.43, 1876.43, 752.262, 100, 0, 0, ''),
(36954, 0, 72, 5428.91, 1870.74, 753.135, 100, 0, 0, ''),
(36954, 0, 73, 5425.11, 1864.65, 753.921, 100, 0, 0, ''),
(36954, 0, 74, 5421.44, 1859.08, 754.605, 100, 0, 0, ''),
(36954, 0, 75, 5417.58, 1853.41, 755.259, 100, 0, 0, ''),
(36954, 0, 76, 5414.22, 1848.43, 755.767, 100, 0, 0, ''),
(36954, 0, 77, 5410.97, 1844.01, 756.175, 100, 0, 0, ''),
(36954, 0, 78, 5407.53, 1839.24, 756.653, 100, 0, 0, ''),
(36954, 0, 79, 5403.28, 1834.46, 757.202, 100, 0, 3695479, 'Remove Remorseless winter'),
(36954, 0, 80, 5399.36, 1830.45, 757.621, 100, 0, 0, ''),
(36954, 0, 81, 5395.35, 1826.22, 758.155, 100, 0, 0, ''),
(36954, 0, 82, 5390.76, 1821.43, 758.758, 100, 0, 0, ''),
(36954, 0, 83, 5386.41, 1817.09, 759.395, 100, 0, 0, ''),
(36954, 0, 84, 5381.79, 1812.79, 759.961, 100, 0, 0, ''),
(36954, 0, 85, 5377.35, 1807.87, 760.336, 100, 0, 0, ''),
(36954, 0, 86, 5372.65, 1802.89, 760.679, 100, 0, 0, ''),
(36954, 0, 87, 5368.02, 1798.66, 761.225, 100, 0, 0, ''),
(36954, 0, 88, 5363.52, 1794.08, 762.108, 100, 0, 0, ''),
(36954, 0, 89, 5359.20, 1789.94, 762.800, 100, 0, 0, ''),
(36954, 0, 90, 5354.53, 1785.36, 763.792, 100, 0, 0, ''),
(36954, 0, 91, 5349.34, 1780.32, 764.907, 100, 0, 0, ''),
(36954, 0, 92, 5344.42, 1776.10, 765.776, 100, 0, 0, ''),
(36954, 0, 93, 5340.08, 1771.89, 766.629, 100, 0, 0, ''),
(36954, 0, 94, 5335.49, 1767.39, 767.568, 100, 0, 0, ''),
(36954, 0, 95, 5324.62, 1756.61, 770.097, 100, 0, 0, ''),
(36954, 0, 96, 5313.08, 1742.52, 773.501, 100, 0, 0, ''),
(36954, 0, 97, 5301.75, 1731.12, 776.697, 100, 0, 0, ''),
(36954, 0, 98, 5293.49, 1719.49, 779.874, 100, 0, 0, ''),
(36954, 0, 99, 5285.43, 1708.06, 782.700, 100, 0, 0, ''),
(36954, 0, 100, 5276.83, 1699.21, 785.745, 100, 0, 0, ''),
(36954, 0, 101, 5274.18, 1694.54, 786.151, 100, 1000, 3695498, 'Handle Epilogue');

-- Jaina movement
DELETE FROM creature_movement_template WHERE entry=36955;
INSERT INTO creature_movement_template(entry, pathId, point, position_x, position_y, position_z, orientation, waittime, script_id, comment) VALUES
(36955, 0, 1, 5577.04, 2235.75, 733.015, 100, 1000, 3695501, 'yell at event start'),
(36955, 0, 2, 5586.12, 2229.25, 733.011, 100, 0, 0, ''),
(36955, 0, 3, 5599.48, 2212, 731.798, 100, 0, 0, ''),
(36955, 0, 4, 5605.98, 2188.69, 731.015, 100, 0, 0, ''),
(36955, 0, 5, 5599.7, 2169.19, 730.815, 100, 0, 0, ''),
(36955, 0, 6, 5586.93, 2148.5, 731.081, 100, 0, 0, ''),
(36955, 0, 7, 5569.53, 2128.22, 731.036, 100, 0, 0, ''),
(36955, 0, 8, 5559.33, 2105.9, 731.248, 100, 1000, 3695508, 'stop at first wall'),
(36955, 1, 1, 5536.34, 2061.5, 731.081, 100, 0, 0, ''),
(36955, 1, 2, 5525.79, 2028.56, 731.917, 100, 0, 0, ''),
(36955, 1, 3, 5508.87, 1995.59, 735.259, 100, 1000, 3695511, 'stop at second wall'),
(36955, 2, 1, 5486.05, 1968.69, 737.494, 100, 0, 0, ''),
(36955, 2, 2, 5464.35, 1921.64, 744.162, 100, 0, 0, ''),
(36955, 2, 3, 5453.08, 1899.74, 747.892, 100, 1000, 3695513, 'stop at third wall'),
(36955, 3, 1, 5421.29, 1860.35, 754.351, 100, 0, 0, ''),
(36955, 3, 2, 5402.54, 1831.55, 757.713, 100, 0, 0, ''),
(36955, 3, 3, 5359.81, 1790.16, 762.757, 100, 0, 0, ''),
(36955, 3, 4, 5335.42, 1766.88, 767.661, 100, 1000, 3695516, 'stop at fourth wall'),
(36955, 4, 1, 5335.42, 1766.88, 767.661, 100, 1000, 3695517, 'yell before end event'),
(36955, 4, 2, 5255.84, 1668.89, 784.3, 0.8, 1000, 3695518, 'yell at end event'),
(36955, 4, 3, 5255.84, 1668.89, 784.3, 0.8, 1000, 3695519, 'handle cave collapse and other epilogue events'),
(36955, 4, 4, 5265.53, 1681.6, 784.3, 0.8, 10000, 3695520, 'say epilogue 1'),
(36955, 4, 5, 5265.53, 1681.6, 784.3, 3.942, 1000, 3695521, 'say epilogue 2');

-- Sylvanas movement
DELETE FROM creature_movement_template WHERE entry=37554;
INSERT INTO creature_movement_template(entry, pathId, point, position_x, position_y, position_z, orientation, waittime, script_id, comment) VALUES
(37554, 0, 1, 5577.04, 2235.75, 733.015, 100, 1000, 3755401, 'yell at event start'),
(37554, 0, 2, 5586.12, 2229.25, 733.011, 100, 0, 0, ''),
(37554, 0, 3, 5599.48, 2212, 731.798, 100, 0, 0, ''),
(37554, 0, 4, 5605.98, 2188.69, 731.015, 100, 0, 0, ''),
(37554, 0, 5, 5599.7, 2169.19, 730.815, 100, 0, 0, ''),
(37554, 0, 6, 5586.93, 2148.5, 731.081, 100, 0, 0, ''),
(37554, 0, 7, 5569.53, 2128.22, 731.036, 100, 0, 0, ''),
(37554, 0, 8, 5559.33, 2105.9, 731.248, 100, 1000, 3755408, 'stop at first wall'),
(37554, 1, 1, 5536.34, 2061.5, 731.081, 100, 0, 0, ''),
(37554, 1, 2, 5525.79, 2028.56, 731.917, 100, 0, 0, ''),
(37554, 1, 3, 5508.87, 1995.59, 735.259, 100, 1000, 3755411, 'stop at second wall'),
(37554, 2, 1, 5486.05, 1968.69, 737.494, 100, 0, 0, ''),
(37554, 2, 2, 5464.35, 1921.64, 744.162, 100, 0, 0, ''),
(37554, 2, 3, 5453.08, 1899.74, 747.892, 100, 1000, 3755413, 'stop at third wall'),
(37554, 3, 1, 5421.29, 1860.35, 754.351, 100, 0, 0, ''),
(37554, 3, 2, 5402.54, 1831.55, 757.713, 100, 0, 0, ''),
(37554, 3, 3, 5359.81, 1790.16, 762.757, 100, 0, 0, ''),
(37554, 3, 4, 5335.42, 1766.88, 767.661, 100, 1000, 3755416, 'stop at fourth wall'),
(37554, 4, 1, 5335.42, 1766.88, 767.661, 100, 1000, 3755417, 'yell before end event'),
(37554, 4, 2, 5255.84, 1668.89, 784.3, 0.8, 1000, 3755418, 'yell at end event'),
(37554, 4, 3, 5255.84, 1668.89, 784.3, 0.8, 1000, 3755419, 'handle cave collapse and other epilogue events'),
(37554, 4, 4, 5265.53, 1681.6, 784.3, 3.942, 1000, 3755420, 'say epilogue');
